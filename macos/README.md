# Мониторинг WAV файлов на macOS

Данная система позволяет автоматически отслеживать появление новых WAV-файлов в указанном каталоге и копировать их в заданную директорию для дальнейшей обработки EchoFlow.

## Требования

- macOS 10.15 или новее
- Python 3.8+

## Настройка

1. Отредактируйте файл `.env` в корневой директории проекта:

```
MONITORED_DIR=/путь/к/директории/для/мониторинга
MIN_FILE_SIZE_KB=100  # Минимальный размер WAV файла в КБ
```

2. Запустите скрипт настройки:

```bash
chmod +x run_mac.sh
./run_mac.sh
```

3. Следуйте инструкциям в интерактивном меню:
   - Выберите пункт 6 для создания/обновления виртуального окружения
   - Выберите пункт 1 для установки и запуска службы
   - Выберите пункт 5 для проверки статуса службы
   - Выберите пункт 3 для остановки службы
   - Выберите пункт 4 для удаления службы

## Виртуальное окружение

Система автоматически создаёт и использует виртуальное окружение Python в директории `.venv`. 
Все зависимости устанавливаются из файла `requirements.txt`.

Для ручного управления виртуальным окружением:

```bash
# Активация виртуального окружения
source .venv/bin/activate

# Деактивация
deactivate
```

## Файлы и скрипты

- `file_monitor.py` - основной скрипт мониторинга
- `macos/com.echoflow.filemonitor.plist` - конфигурация launchd
- `macos/install_service.sh` - установка службы
- `macos/start_service.sh` - запуск службы
- `macos/stop_service.sh` - остановка службы
- `macos/uninstall_service.sh` - удаление службы
- `macos/status_service.sh` - проверка статуса службы
- `macos/create_venv.sh` - создание/обновление виртуального окружения

## Логи и отладка

Логи службы можно найти в следующих файлах:
- `/tmp/echoflow.filemonitor.out` - стандартный вывод
- `/tmp/echoflow.filemonitor.err` - ошибки
- `file_monitor.log` - лог-файл в директории проекта

## Автоматический запуск

Служба настроена на автоматический запуск при загрузке системы и перезапуск в случае сбоя. 
Служба использует виртуальное окружение Python для изоляции зависимостей.

## Решение проблем

1. Если служба не запускается, проверьте:
   - Правильность путей в файле `.env`
   - Наличие прав доступа к указанным директориям
   - Логи в `/tmp/echoflow.filemonitor.err`
   - Статус виртуального окружения через `./macos/status_service.sh`

2. Для пересоздания виртуального окружения:
   ```bash
   ./run_mac.sh  # Выберите пункт 6
   ```

3. Для ручного запуска мониторинга (для отладки):
   ```bash
   ./run_mac.sh  # Выберите пункт 7
   ```

4. Для просмотра подробного статуса:
   ```bash
   ./macos/status_service.sh
   ```

5. Если виртуальное окружение не создается:
   ```bash
   # Проверьте наличие venv модуля
   python3 -m venv --help
   
   # Проверьте версию Python
   python3 --version
   ``` 